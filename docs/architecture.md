# Madoka Browser Agent æ¶æ„æ–‡æ¡£

> æµè§ˆå™¨ç‰ˆ Cursor - è®© AI ç†è§£ç½‘é¡µå¹¶å®‰å…¨æ‰§è¡Œæ“ä½œ

## ç›®å½•

- [é¡¹ç›®æ„¿æ™¯](#é¡¹ç›®æ„¿æ™¯)
- [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
- [æŠ€æœ¯åŸç†](#æŠ€æœ¯åŸç†)
- [æ¨¡å—è¯¦è§£](#æ¨¡å—è¯¦è§£)
- [MVP è¿›åº¦](#mvp-è¿›åº¦)
- [åç»­è§„åˆ’](#åç»­è§„åˆ’)

---

## é¡¹ç›®æ„¿æ™¯

### æœ€ç»ˆç›®æ ‡

è®© AI èƒ½åƒåœ¨ Cursor ä¸­"ç†è§£ä»£ç å¹¶ç²¾ç¡®ä¿®æ”¹"ä¸€æ ·ï¼Œåœ¨ç½‘é¡µä¸­ï¼š

1. **ç†è§£ DOM ç»“æ„** - è¯†åˆ«é¡µé¢å¯äº¤äº’å…ƒç´ 
2. **ç”Ÿæˆæœ€å°æ“ä½œæŒ‡ä»¤** - è¾“å‡ºç»“æ„åŒ– Action DSL
3. **å®‰å…¨æ‰§è¡Œ & é«˜äº®é¢„è§ˆ** - å¯è§†åŒ–å±•ç¤ºæ“ä½œæ„å›¾
4. **æ”¯æŒäººå·¥å®¡æŸ¥ä¸ä¸€é”®æ’¤é”€** - æ¯æ­¥ç¡®è®¤ï¼Œå¯å›é€€

### Cursor æ¦‚å¿µæ˜ å°„

| Cursor (ä»£ç ä¸–ç•Œ) | Madoka (DOM ä¸–ç•Œ) | å½“å‰çŠ¶æ€ |
|------------------|-------------------|---------|
| AST = è¯­æ³•æ ‘ | DOM Tree = é¡µé¢ç»“æ„ | âœ… å·²å®ç° |
| LSP = ç±»å‹æœåŠ¡ | Action Parser = äº¤äº’è¯†åˆ« | âœ… å·²å®ç° |
| Diff = ä¿®æ”¹èŒƒå›´ | Action DSL = æ“ä½œæ„å›¾ | âœ… å·²å®ç° |
| Human Review = diff é¢„è§ˆ | ActionPlan UI = å¯è§†åŒ–ç¡®è®¤ | âœ… å·²å®ç° |
| Repo Index = é¡¹ç›®ç´¢å¼• | IndexedDB = ç«™ç‚¹è¡Œä¸ºè®°å¿† | ğŸ”² å¾…å®ç° |

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

```
ä¸è®© AI ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯è®©å®ƒ"æå»ºè®®"ï¼Œç”±ç³»ç»Ÿå®‰å…¨æ‰§è¡Œ
```

---

## æ ¸å¿ƒæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢ (SidePanel)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   èŠå¤©é¢æ¿   â”‚  â”‚  è®¾ç½®é¢æ¿   â”‚  â”‚   ActionPlan é¢æ¿   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ Chrome Message
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Background Service Worker                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æœç´¢æ¨¡å—   â”‚  â”‚   LLM API   â”‚  â”‚   Action è·¯ç”±å™¨    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ chrome.tabs.sendMessage
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Content Script                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Reader    â”‚  â”‚ActionParser â”‚  â”‚  ActionExecutor    â”‚  â”‚
â”‚  â”‚ (å†…å®¹æå–)  â”‚  â”‚ (ç©ºé—´è§£æ)  â”‚  â”‚   (æ“ä½œæ‰§è¡Œ)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ DOM API
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å½“å‰ç½‘é¡µ (DOM World)                    â”‚
â”‚                                                              â”‚
â”‚   [data-madoka-action-id="act_v1_0"]  â† æ³¨å…¥çš„ç¨³å®šå¼•ç”¨      â”‚
â”‚   [data-madoka-action-id="act_v1_1"]                        â”‚
â”‚   ...                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·ç‚¹å‡» "Agent æ¨¡å¼"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ extractActionSpace â”‚  â† SidePanel å‘èµ·è¯·æ±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ActionParser    â”‚  â† Content Script æ‰«æ DOM
â”‚ .extract()      â”‚     è¯„åˆ†ã€è¿‡æ»¤ã€æ³¨å…¥ actionId
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ActionSpace     â”‚  â† è¿”å›ç»“æ„åŒ–æ•°æ®
â”‚ {globalActions, â”‚
â”‚  contextualActions}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ActionPlan UI   â”‚  â† å±•ç¤ºå¾…æ‰§è¡Œæ“ä½œ
â”‚ [ç¡®è®¤] [è·³è¿‡]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ç”¨æˆ·ç¡®è®¤
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ActionExecutor  â”‚  â† é«˜äº® â†’ æ‰§è¡Œ â†’ åé¦ˆ
â”‚ .execute()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€æœ¯åŸç†

### 1. Action Space æå– (ActionParser)

**æ ¸å¿ƒæ€æƒ³**: ç±»ä¼¼ Readability çš„"æ–‡æœ¬å¯†åº¦è¯„åˆ†"ï¼Œæˆ‘ä»¬ä½¿ç”¨"äº¤äº’å¯†åº¦è¯„åˆ†"

#### å¤šç»´åº¦è¯„åˆ†ä½“ç³»

| ç»´åº¦ | æƒé‡ | æ£€æµ‹æ–¹å¼ |
|-----|------|---------|
| äº‹ä»¶ç›‘å¬ | 40åˆ† | `onclick` / `__reactProps` / `getEventListeners` |
| åŸç”Ÿè¯­ä¹‰ | 25åˆ† | `button`, `a`, `input`, `select` æ ‡ç­¾ |
| ARIA è§’è‰² | 20åˆ† | `role="button"`, `role="link"` ç­‰ |
| å¯èšç„¦æ€§ | 10åˆ† | `tabIndex >= 0` |
| è§†è§‰ä¿¡å· | 15åˆ† | `cursor: pointer`, `user-select: none` |
| Class å¯å‘å¼ | 10åˆ† | `/btn|button|link|submit/` æ­£åˆ™åŒ¹é… |
| äº¤äº’å¯†åº¦ | 15åˆ† | é‚»å±…å…ƒç´ ä¸­äº¤äº’å…ƒç´ çš„æ¯”ä¾‹ |
| ä¸Šä¸‹æ–‡ç»‘å®š | 10åˆ† | æ˜¯å¦åœ¨è¡¨æ ¼è¡Œ/åˆ—è¡¨é¡¹ä¸­ |

#### é˜ˆå€¼ä¸è¿‡æ»¤

```typescript
const SCORE_THRESHOLD = 15  // ä½äºæ­¤åˆ†æ•°çš„å…ƒç´ ä¸ä½œä¸º Action
```

#### æ¡†æ¶å…¼å®¹æ€§

- **React**: æ£€æµ‹ `__reactProps$` / `__reactEventHandlers$`
- **Vue**: æ£€æµ‹ `__vueParentComponent`
- **äº‹ä»¶å§”æ‰˜**: æ£€æŸ¥çˆ¶å…ƒç´ çš„äº‹ä»¶ç›‘å¬

### 2. ç¨³å®šå¼•ç”¨æœºåˆ¶ (Action ID)

**é—®é¢˜**: ä¼ ç»Ÿçš„ CSS Selector åœ¨ SPA ä¸­å®¹æ˜“å¤±æ•ˆ

**è§£å†³æ–¹æ¡ˆ**: æå–æ—¶æ³¨å…¥ç¨³å®šå±æ€§

```typescript
// æå–æ—¶
el.dataset.madokaActionId = `act_v${version}_${index}`

// æ‰§è¡Œæ—¶
document.querySelector(`[data-madoka-action-id="${actionId}"]`)
```

**ä¼˜åŠ¿**:
- ä¸€å¯¹ä¸€ç»‘å®šï¼Œæ— æ­§ä¹‰
- ç‰ˆæœ¬å·é˜²æ­¢ DOM å˜åŒ–åè¯¯æ“ä½œ
- å¯è°ƒè¯•ï¼šDevTools ç›´æ¥å¯è§

### 3. å±é™©æ“ä½œè¯†åˆ«

```typescript
const DANGER_KEYWORDS = {
  high: ['delete', 'remove', 'åˆ é™¤', 'ç§»é™¤', 'logout', 'é€€å‡º'],
  medium: ['submit', 'confirm', 'æäº¤', 'ç¡®è®¤', 'pay', 'æ”¯ä»˜'],
}
```

å±é™©æ“ä½œåœ¨ UI ä¸­ä¼šæ˜¾ç¤ºè­¦å‘Šï¼Œè¦æ±‚äºŒæ¬¡ç¡®è®¤ã€‚

### 4. ä¸Šä¸‹æ–‡ç»‘å®š (Row Context)

å¯¹äºè¡¨æ ¼/åˆ—è¡¨ä¸­çš„æ“ä½œï¼Œè‡ªåŠ¨æå–è¡Œä¸Šä¸‹æ–‡ï¼š

```typescript
interface RowContext {
  rowKey: string | null    // è¡Œå”¯ä¸€æ ‡è¯† (data-id)
  rowLabel: string | null  // è¡Œå¯è¯»æ ‡ç­¾ (ç¬¬ä¸€åˆ—æ–‡æœ¬)
  fullText: string | null  // å®Œæ•´è¡Œæ–‡æœ¬
}
```

è¿™ä½¿å¾— AI å¯ä»¥ç”Ÿæˆç±»ä¼¼ "å¯¹ã€å¼ ä¸‰ã€‘æ‰§è¡Œã€åˆ é™¤ã€‘" çš„è¯­ä¹‰åŒ–æ“ä½œã€‚

---

## æ¨¡å—è¯¦è§£

### Content Script æ¨¡å—

#### `reader.ts` - é¡µé¢å†…å®¹æå–

- **èŒè´£**: å°†ç½‘é¡µå†…å®¹è½¬æ¢ä¸º Markdown
- **åŒé‡ç­–ç•¥**: Readability ä¼˜å…ˆï¼ŒDirect æå–å…œåº•
- **è¾“å‡º**: ç»“æ„åŒ– Markdown + å…ƒä¿¡æ¯

#### `action-parser.ts` - Action Space æå–

- **èŒè´£**: è¯†åˆ«é¡µé¢å¯äº¤äº’å…ƒç´ 
- **æ ¸å¿ƒ**: å¤šç»´åº¦è¯„åˆ† + é˜ˆå€¼è¿‡æ»¤
- **è¾“å‡º**: ActionSpace ç»“æ„ä½“

#### `action-executor.ts` - æ“ä½œæ‰§è¡Œ

- **èŒè´£**: æ‰§è¡Œ Actionï¼Œåé¦ˆç»“æœ
- **èƒ½åŠ›**: ç‚¹å‡»ã€è¾“å…¥ã€é€‰æ‹©ã€åˆ‡æ¢
- **é«˜äº®**: çŠ¶æ€åŒ–é«˜äº® (pending/executing/success/failed)

### Background æ¨¡å—

#### `index.ts` - æ¶ˆæ¯è·¯ç”±

- è·¯ç”± Action ç›¸å…³æ¶ˆæ¯åˆ° Content Script
- ç®¡ç† Tab çŠ¶æ€

#### `search.ts` - æœç´¢æ‰§è¡Œ

- çœŸå®æ ‡ç­¾é¡µæœç´¢ (ç»•è¿‡åçˆ¬)
- æœç´¢ç»“æœè§£æ

#### `api.ts` - LLM è°ƒç”¨

- é€šä¹‰åƒé—® API æµå¼è°ƒç”¨
- æ„å»ºç»“æ„åŒ– Prompt

### SidePanel æ¨¡å—

#### `context/ChatContext.tsx` - çŠ¶æ€ç®¡ç†

æ‰©å±•åçš„çŠ¶æ€ç»“æ„ï¼š

```typescript
interface ExtendedChatState {
  // åŸæœ‰èŠå¤©çŠ¶æ€
  messages: Message[]
  status: ChatStatus
  ...
  
  // æ–°å¢ Agent çŠ¶æ€
  agent: {
    isAgentMode: boolean
    actionSpace: ActionSpace | null
    actionPlan: ActionPlanItem[]
    currentActionIndex: number
    isExecuting: boolean
    executionHistory: ActionResult[]
  }
}
```

#### `components/ActionPlan.tsx` - æ“ä½œè®¡åˆ’ UI

- å±•ç¤ºå¾…æ‰§è¡Œæ“ä½œåˆ—è¡¨
- å±é™©ç­‰çº§å¯è§†åŒ–
- ç¡®è®¤/è·³è¿‡æ§åˆ¶
- æ‰§è¡Œç»“æœåé¦ˆ

---

## MVP è¿›åº¦

### ä¸‰é˜¶æ®µè§„åˆ’

| é˜¶æ®µ | ç›®æ ‡ | çŠ¶æ€ |
|-----|------|------|
| **Phase 1** | æ‰‹åŠ¨æ¨¡å¼ - éªŒè¯å¯è¡Œæ€§ | âœ… å·²å®Œæˆ |
| **Phase 2** | æ¥å…¥ LLM - è‡ªåŠ¨åŒ–å†³ç­– | ğŸ”² å¾…å¼€å‘ |
| **Phase 3** | è‡ªå­¦ä¹ é—­ç¯ - è¡Œä¸ºè®°å¿† | ğŸ”² å¾…å¼€å‘ |

### Phase 1 å®Œæˆæ¸…å•

- [x] Action Types ç±»å‹å®šä¹‰
- [x] Action Parser å®ç° (è¯„åˆ†ã€è¿‡æ»¤ã€æ³¨å…¥)
- [x] Action Executor å®ç° (é«˜äº®ã€ç‚¹å‡»ã€è¾“å…¥ã€é€‰æ‹©)
- [x] Content Script æ¶ˆæ¯å¤„ç†æ‰©å±•
- [x] Background æ¶ˆæ¯è·¯ç”±æ‰©å±•
- [x] ActionPlan UI ç»„ä»¶
- [x] ChatContext Agent çŠ¶æ€æ‰©å±•
- [x] ä¸»æµç¨‹é›†æˆ (æå– â†’ å±•ç¤º â†’ ç¡®è®¤ â†’ æ‰§è¡Œ)

### å½“å‰èƒ½åŠ›

1. âœ… è‡ªåŠ¨æ£€æµ‹é¡µé¢å¯äº¤äº’å…ƒç´ 
2. âœ… åœ¨ SidePanel å±•ç¤ºæ“ä½œåˆ—è¡¨
3. âœ… å•æ­¥ç¡®è®¤æ‰§è¡Œ
4. âœ… æ“ä½œå‰é«˜äº®ç›®æ ‡å…ƒç´ 
5. âœ… æ‰§è¡Œç»“æœåé¦ˆ (æˆåŠŸ/å¤±è´¥/DOMå˜åŒ–)
6. âœ… å±é™©æ“ä½œæ ‡è¯†

### å½“å‰é™åˆ¶

1. âŒ ä¸æ”¯æŒ iframe å†…å…ƒç´  (MVP èŒƒå›´å¤–)
2. âŒ ä¸æ”¯æŒ Shadow DOM (éœ€åç»­æ‰©å±•)
3. âŒ æ—  LLM è‡ªåŠ¨è§„åˆ’ (Phase 2)
4. âŒ æ— è¡Œä¸ºè®°å¿†/å­¦ä¹  (Phase 3)

---

## åç»­è§„åˆ’

### Phase 2: æ¥å…¥ LLM

```
ç”¨æˆ·è¾“å…¥ "å¸®æˆ‘å¡«å†™ç™»å½•è¡¨å•ï¼Œç”¨æˆ·å testï¼Œå¯†ç  123"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM ç†è§£æ„å›¾    â”‚  â† è§£æè‡ªç„¶è¯­è¨€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒ¹é… ActionSpaceâ”‚  â† æ‰¾åˆ°å¯¹åº”çš„ input/button
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆ Action Planâ”‚  â† è¾“å‡ºæ“ä½œåºåˆ—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å·¥ä½œ**:
- Action DSL Schema è®¾è®¡
- LLM Prompt å·¥ç¨‹
- æ„å›¾åˆ° Action çš„æ˜ å°„

### Phase 3: è‡ªå­¦ä¹ é—­ç¯

**IndexedDB å­˜å‚¨ç»“æ„**:

```typescript
interface SiteSchema {
  urlPattern: string           // "jw.nju.edu.cn/*"
  name: string                 // "æ•™åŠ¡ç³»ç»Ÿå…¬å‘Šé¡µ"
  blocks: BlockSchema[]        // é¡µé¢åŒºå—å®šä¹‰
  successfulActions: Action[]  // æˆåŠŸæ‰§è¡Œçš„æ“ä½œè®°å½•
  failedActions: Action[]      // å¤±è´¥æ¡ˆä¾‹
}
```

**å­¦ä¹ æœºåˆ¶**:
- æˆåŠŸæ‰§è¡Œ â†’ è®°å½• pattern
- å¤±è´¥æ¡ˆä¾‹ â†’ åŠ å…¥ negative examples
- ç›¸ä¼¼é¡µé¢ â†’ å¤ç”¨å†å² schema

---

## æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ |
|-----|------|
| æ’ä»¶æ¡†æ¶ | Chrome Extension Manifest V3 |
| å‰ç«¯ UI | React 18 + TypeScript |
| æ ·å¼ | TailwindCSS |
| åŠ¨ç”» | Framer Motion |
| çŠ¶æ€ç®¡ç† | React Context + useReducer |
| æ„å»ºå·¥å…· | Vite + CRXJS |
| LLM | é€šä¹‰åƒé—® (å¯åˆ‡æ¢) |
| å­˜å‚¨ | Chrome Storage / IndexedDB (è§„åˆ’ä¸­) |

---

## æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ background/
â”‚   â”œâ”€â”€ index.ts        # æ¶ˆæ¯è·¯ç”± + Action å¤„ç†
â”‚   â”œâ”€â”€ config.ts       # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ search.ts       # æœç´¢é€»è¾‘
â”‚   â””â”€â”€ api.ts          # LLM API
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ index.ts        # Content Script å…¥å£
â”‚   â”œâ”€â”€ reader.ts       # é¡µé¢å†…å®¹æå– (Markdown)
â”‚   â”œâ”€â”€ parser.ts       # æœç´¢ç»“æœè§£æ
â”‚   â”œâ”€â”€ action-parser.ts   # â­ Action Space æå–
â”‚   â””â”€â”€ action-executor.ts # â­ Action æ‰§è¡Œå™¨
â”œâ”€â”€ sidepanel/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ActionPlan.tsx # â­ Action è®¡åˆ’ UI
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ InputArea.tsx  # æ‰©å±•: Agent æ¨¡å¼æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ Message.tsx
â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â””â”€â”€ SettingsPanel.tsx
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ ChatContext.tsx # æ‰©å±•: Agent çŠ¶æ€
â”‚   â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ styles/
â”‚   â””â”€â”€ App.tsx           # é›†æˆ ActionPlan
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ types.ts          # èŠå¤©ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ action-types.ts   # â­ Action ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ constants.ts
â”‚   â””â”€â”€ messaging.ts
â””â”€â”€ manifest.json
```

---

## å‚è€ƒæ–‡æ¡£

- [web_cursor.md](../web_cursor.md) - æµè§ˆå™¨ç‰ˆ Cursor æ¶æ„è®¾è®¡
- [web_cursor2.md](../web_cursor2.md) - æ·±åº¦å·¥ç¨‹å¯¹ç…§
- [reader.md](../reader.md) - Readability åŸç†è§£æ
- [personal_thinking.md](../personal_thinking.md) - è®¾è®¡æ€è€ƒ

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0 | æ›´æ–°æ—¶é—´: 2026-01-18 | MVP Phase 1 å®Œæˆ*
